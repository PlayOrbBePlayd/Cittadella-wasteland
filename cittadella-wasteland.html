<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cittadella Wasteland: Kelly's Search for Nicole</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to bottom, #2c1810, #1a0f0a);
            color: #d4c5b0;
            overflow: hidden;
            height: 100vh;
        }

        #game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #ff9966;
            text-shadow: 2px 2px 4px #000;
            border-bottom: 2px solid #8b4513;
            padding-bottom: 10px;
        }

        #subtitle {
            text-align: center;
            font-size: 14px;
            color: #b8927f;
            margin-top: -15px;
            margin-bottom: 20px;
            font-style: italic;
        }

        #stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #5a3a1a;
            border-radius: 5px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
        }

        .health { color: #ff4444; }
        .supplies { color: #44ff44; }
        .clues { color: #ffaa44; }

        #game-screen {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 15px;
            position: relative;
        }

        #story-text {
            line-height: 1.8;
            margin-bottom: 20px;
            min-height: 200px;
        }

        .location-name {
            color: #ffaa44;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #5a3a1a;
            padding-bottom: 5px;
        }

        .italian-text {
            color: #8fbc8f;
            font-style: italic;
            font-size: 14px;
        }

        #choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-btn {
            background: linear-gradient(to bottom, #5a3a1a, #3a2010);
            border: 2px solid #8b4513;
            color: #d4c5b0;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            text-align: left;
            font-family: 'Courier New', monospace;
        }

        .choice-btn:hover {
            background: linear-gradient(to bottom, #6a4a2a, #4a3020);
            border-color: #ff9966;
            transform: translateX(5px);
        }

        .choice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .choice-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        #inventory {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #5a3a1a;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .inventory-item {
            display: inline-block;
            margin-right: 15px;
            color: #ffaa44;
        }

        .danger-text {
            color: #ff4444;
            font-weight: bold;
        }

        .success-text {
            color: #44ff44;
            font-weight: bold;
        }

        .game-over {
            text-align: center;
            font-size: 24px;
            color: #ff4444;
            margin: 50px 0;
        }

        .victory {
            text-align: center;
            font-size: 24px;
            color: #44ff44;
            margin: 50px 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s;
        }

        /* Scrollbar styling */
        #game-screen::-webkit-scrollbar {
            width: 10px;
        }

        #game-screen::-webkit-scrollbar-track {
            background: #1a0f0a;
        }

        #game-screen::-webkit-scrollbar-thumb {
            background: #5a3a1a;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="title">CITTADELLA WASTELAND</div>
        <div id="subtitle">Kelly's Search for Nicole</div>
        
        <div id="stats-bar">
            <div class="stat">
                <div class="stat-label">SALUTE</div>
                <div class="stat-value health" id="health">100</div>
            </div>
            <div class="stat">
                <div class="stat-label">PROVVISTE</div>
                <div class="stat-value supplies" id="supplies">5</div>
            </div>
            <div class="stat">
                <div class="stat-label">INDIZI</div>
                <div class="stat-value clues" id="clues">0</div>
            </div>
        </div>

        <div id="game-screen" class="fade-in">
            <div id="story-text"></div>
            <div id="choices"></div>
        </div>

        <div id="inventory">
            <strong>Inventario:</strong> <span id="inventory-list">Gas mask, Flashlight</span>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            health: 100,
            supplies: 5,
            clues: 0,
            inventory: ['Gas mask', 'Flashlight'],
            location: 'start',
            foundJournal: false,
            metPadre: false,
            gameOver: false
        };

        // Story nodes
        const story = {
            start: {
                location: "Piazza Vittorio Emanuele",
                text: `You stand in the center of what was once Cittadella's beating heart. The fountain is dry, filled with debris. Vines crawl up the ancient cathedral bell tower in the distance. Three weeks. Nicole has been missing for three weeks.

You pull out her journal - the last page reads:
<span class="italian-text">"Villa Contarini, nella cantina segreta. Se non torno, Kelly... non lasciare che muoia con me."</span>
<span style="font-size: 12px;">(Villa Contarini, in the secret cellar. If I don't return, Kelly... don't let it die with me.)</span>

The villa lies beyond the walls, in the Red Zone. You'll need supplies and information before venturing there.`,
                choices: [
                    { text: "üèõÔ∏è Visit Padre Angelo at the Cathedral", action: 'cathedral' },
                    { text: "üè™ Search the Old Market for supplies", action: 'market' },
                    { text: "üö™ Head straight for the city gates", action: 'gates_early', requires: { supplies: 3 } }
                ]
            },

            cathedral: {
                location: "Il Duomo - The Cathedral",
                text: `The cathedral's grand doors hang askew. Inside, shafts of dusty light illuminate the ravaged interior. Stained glass lies shattered on marble floors. From the catacombs below, you hear voices - survivors.

Padre Angelo emerges from the shadows, his weathered face breaking into a sad smile.

<span class="italian-text">"Kelly. Ancora cerchi Nicole?"</span> (Still searching for Nicole?)

You nod. He sighs deeply.

<span class="italian-text">"Era una ragazza coraggiosa. Troppo coraggiosa."</span> (She was a brave girl. Too brave.)

He hands you a worn map of the villa grounds and a first aid kit.

"Be careful, child. The Red Zone... it changes people."`,
                onEnter: () => {
                    gameState.clues += 1;
                    gameState.supplies += 2;
                    gameState.metPadre = true;
                    gameState.inventory.push('Villa map');
                },
                choices: [
                    { text: "üìñ Ask about Nicole's last visit", action: 'padre_info' },
                    { text: "‚õ™ Ask about The Fracture", action: 'fracture_info' },
                    { text: "üö∂ Leave and continue searching", action: 'post_cathedral' }
                ]
            },

            padre_info: {
                location: "Il Duomo - The Cathedral",
                text: `Padre Angelo's eyes grow distant.

<span class="italian-text">"Nicole venne qui tre settimane fa. Disse che aveva trovato vecchi documenti... prove che il Fracture non era un incidente."</span>

(Nicole came here three weeks ago. She said she had found old documents... proof that the Fracture wasn't an accident.)

Your blood runs cold. An accident? Everyone assumed it was an accident. A failed energy experiment. But if Nicole found proof otherwise...

<span class="italian-text">"Aveva paura, Kelly. Ma era determinata. Disse che la verit√† era sepolta sotto Villa Contarini."</span>

(She was afraid, Kelly. But determined. She said the truth was buried beneath Villa Contarini.)

<span class="success-text">+1 CLUE GAINED</span>`,
                onEnter: () => {
                    gameState.clues += 1;
                },
                choices: [
                    { text: "‚õ™ Ask about The Fracture", action: 'fracture_info' },
                    { text: "üö∂ Leave cathedral", action: 'post_cathedral' }
                ]
            },

            fracture_info: {
                location: "Il Duomo - The Cathedral",
                text: `<span class="italian-text">"Il Fracture..."</span> Padre Angelo makes the sign of the cross.

"2037. I was young then. They said it was a new energy source - clean, infinite. The facility was near Venice, not far from here."

He gestures to the shattered stained glass. "One moment, the world was normal. The next... the sky turned green. The walls saved us, trapped us. Cittadella became both sanctuary and prison."

"The official story was an accident. But Nicole... she believed someone did this deliberately. And if she's right, Kelly, then whoever did it is still out there."`,
                choices: [
                    { text: "üìñ Ask about Nicole's last visit", action: 'padre_info' },
                    { text: "üö∂ Leave cathedral", action: 'post_cathedral' }
                ]
            },

            post_cathedral: {
                location: "Via Roma - The Street",
                text: `You step back into the ruined street. The map Padre Angelo gave you shows a path through the walls to Villa Contarini. But you'll need more supplies for the journey.

The Old Market isn't far. Or you could head straight for the gates if you're feeling confident.`,
                choices: [
                    { text: "üè™ Go to the Old Market", action: 'market' },
                    { text: "üö™ Head for the city gates", action: 'gates', requires: { supplies: 5 } }
                ]
            },

            market: {
                location: "Mercato Vecchio - Old Market",
                text: `The market building's Renaissance arches still stand, though the roof has long since collapsed. Makeshift stalls built from rubble line the perimeter. Scavengers pick through debris.

A merchant waves you over - <span class="italian-text">"Che cosa cerchi?"</span> (What are you looking for?)

You spot several useful items among the salvage:
- Canned food (2 supplies)
- Medical supplies (1 supply, heals 30 health)
- Rope and climbing gear (needed for villa)`,
                choices: [
                    { text: "ü•´ Take canned food (2 supplies)", action: 'take_food' },
                    { text: "üíä Take medical supplies", action: 'take_medicine' },
                    { text: "ü™¢ Take climbing gear", action: 'take_rope' },
                    { text: "üö∂ Leave market", action: 'post_market' }
                ]
            },

            take_food: {
                location: "Mercato Vecchio - Old Market",
                text: `You grab several cans - tomatoes, beans, even some pasta. The labels are faded but readable.

<span class="success-text">+2 SUPPLIES</span>

The merchant nods. <span class="italian-text">"Buona fortuna l√† fuori."</span> (Good luck out there.)`,
                onEnter: () => {
                    gameState.supplies += 2;
                },
                choices: [
                    { text: "üíä Take medical supplies", action: 'take_medicine' },
                    { text: "ü™¢ Take climbing gear", action: 'take_rope' },
                    { text: "üö∂ Leave market", action: 'post_market' }
                ]
            },

            take_medicine: {
                location: "Mercato Vecchio - Old Market",
                text: `A first aid kit with the red cross still visible. Bandages, antiseptic, painkillers.

<span class="success-text">+1 SUPPLY, +30 HEALTH</span>`,
                onEnter: () => {
                    gameState.supplies += 1;
                    gameState.health = Math.min(100, gameState.health + 30);
                    gameState.inventory.push('First aid kit');
                },
                choices: [
                    { text: "ü•´ Take canned food", action: 'take_food' },
                    { text: "ü™¢ Take climbing gear", action: 'take_rope' },
                    { text: "üö∂ Leave market", action: 'post_market' }
                ]
            },

            take_rope: {
                location: "Mercato Vecchio - Old Market",
                text: `Sturdy rope and old climbing gear. The villa has multiple levels - this could be essential.

<span class="success-text">CLIMBING GEAR ACQUIRED</span>`,
                onEnter: () => {
                    gameState.inventory.push('Climbing gear');
                },
                choices: [
                    { text: "ü•´ Take canned food", action: 'take_food' },
                    { text: "üíä Take medical supplies", action: 'take_medicine' },
                    { text: "üö∂ Leave market", action: 'post_market' }
                ]
            },

            post_market: {
                location: "Via Roma - The Street",
                text: `You leave the market with your supplies. The city gates are ahead. Beyond them lies the Red Zone... and Villa Contarini.

Are you ready?`,
                choices: [
                    { text: "üö™ Go to the gates", action: 'gates' },
                    { text: "üèõÔ∏è Return to cathedral", action: 'cathedral', requires: { metPadre: false } }
                ]
            },

            gates_early: {
                location: "Le Mura - The Gates",
                text: `<span class="danger-text">You're not prepared!</span>

The guards at the gate shake their heads. <span class="italian-text">"Troppo pericoloso senza provviste."</span> (Too dangerous without supplies.)

You need at least 5 supplies to venture into the Red Zone.`,
                choices: [
                    { text: "üè™ Go gather supplies", action: 'market' },
                    { text: "üèõÔ∏è Visit the cathedral", action: 'cathedral' }
                ]
            },

            gates: {
                location: "Le Mura - The Gates",
                text: `The massive medieval gates loom before you. Guards in makeshift hazmat suits eye you warily.

<span class="italian-text">"Stai davvero andando l√† fuori?"</span> (Are you really going out there?)

Beyond the gates, you can see the contaminated zone - an eerie green mist hanging over overgrown ruins. In the distance, Villa Contarini's baroque silhouette rises against the toxic sky.

This is it. Nicole is out there. Or answers about what happened to her.`,
                choices: [
                    { text: "üé≠ Enter the Red Zone", action: 'red_zone', requires: { supplies: 5 } },
                    { text: "üîô Go back and prepare more", action: 'post_market' }
                ]
            },

            red_zone: {
                location: "Zona Rossa - Red Zone",
                text: `You pass through the gates. They seal behind you with a heavy metallic clang.

The contamination is immediately visible - the air shimmers with a sickly green hue. You pull on your gas mask. Your geiger counter begins to click softly.

The path to Villa Contarini winds through overgrown gardens and collapsed buildings. Nature has reclaimed everything, but it's wrong - mutated. Vines as thick as your arm, flowers that glow faintly.

<span class="danger-text">-1 SUPPLY (used gas mask filter)</span>

In the distance, you hear something moving. Large. Not human.`,
                onEnter: () => {
                    gameState.supplies -= 1;
                },
                choices: [
                    { text: "ü§´ Move quietly through the gardens", action: 'stealth_path' },
                    { text: "üèÉ Run quickly toward the villa", action: 'run_path' },
                    { text: "üîç Investigate the sound", action: 'investigate_creature' }
                ]
            },

            stealth_path: {
                location: "Villa Contarini Grounds",
                text: `You move silently between the overgrown hedges. The clicking of your geiger counter is your only companion.

Through the toxic mist, you spot it - a massive creature, once perhaps a wild boar, now mutated beyond recognition. It hasn't seen you.

You hold your breath and continue forward.

<span class="success-text">SUCCESS - Avoided danger</span>

The villa's main entrance looms ahead. The baroque facade is crumbling but still beautiful in its decay.`,
                choices: [
                    { text: "üö™ Enter through main doors", action: 'villa_entrance' },
                    { text: "ü™ü Find another way in", action: 'villa_window', requires: { inventory: 'Climbing gear' } }
                ]
            },

            run_path: {
                location: "Villa Contarini Grounds",
                text: `You break into a run. Your footsteps echo through the dead gardens.

<span class="danger-text">DANGER!</span>

A massive mutated creature emerges from the mist - what was once a wild boar, now a hulking monster. It charges!

You dive behind a collapsed statue. The creature's massive head crashes into the marble, giving you time to reach the villa.

<span class="danger-text">-20 HEALTH (minor injuries from fall)</span>

Your heart pounds as you reach the villa's entrance.`,
                onEnter: () => {
                    gameState.health -= 20;
                },
                choices: [
                    { text: "üö™ Enter through main doors", action: 'villa_entrance' },
                    { text: "ü™ü Find another way in", action: 'villa_window', requires: { inventory: 'Climbing gear' } }
                ]
            },

            investigate_creature: {
                location: "Villa Gardens",
                text: `You move toward the sound, curiosity overcoming caution.

Through the toxic fog, you see it clearly - a massive mutated boar, tusks like scythes, skin mottled with glowing patches.

It sees you.

<span class="danger-text">-30 HEALTH (creature attack!)</span>
<span class="danger-text">-2 SUPPLIES (used in emergency escape)</span>

You barely escape, diving through a gap in a collapsed wall. The creature can't follow. You're hurt but alive.`,
                onEnter: () => {
                    gameState.health -= 30;
                    gameState.supplies -= 2;
                },
                choices: [
                    { text: "üè• Use medical supplies", action: 'heal_self', requires: { inventory: 'First aid kit' } },
                    { text: "üö™ Continue to villa entrance", action: 'villa_entrance' }
                ]
            },

            heal_self: {
                location: "Villa Gardens",
                text: `You quickly bandage your wounds using the first aid kit. The pain subsides.

<span class="success-text">+40 HEALTH</span>

You need to keep moving. Nicole is inside that villa.`,
                onEnter: () => {
                    gameState.health = Math.min(100, gameState.health + 40);
                },
                choices: [
                    { text: "üö™ Enter villa", action: 'villa_entrance' }
                ]
            },

            villa_entrance: {
                location: "Villa Contarini - Main Hall",
                text: `The villa's interior takes your breath away. Even in decay, the baroque splendor is evident - frescoed ceilings, marble columns, grand staircases.

But everything is covered in dust and vines. Your flashlight beam cuts through the darkness.

On the floor, you spot something that makes your heart skip:

Nicole's backpack.

You rush over. It's empty except for a piece of paper:

<span class="italian-text">"Kelly - Se stai leggendo questo, sono nei sotterranei. La cantina segreta √® dietro la cucina. Il codice √® 1220 - l'anno di fondazione di Cittadella. Quello che ho trovato... cambier√† tutto. Ti amo. - Nicole"</span>

(If you're reading this, I'm in the basement. The secret cellar is behind the kitchen. The code is 1220 - Cittadella's founding year. What I found... will change everything. I love you. - Nicole)

<span class="success-text">+2 CLUES GAINED</span>

She was here. She might still be here!`,
                onEnter: () => {
                    gameState.clues += 2;
                },
                choices: [
                    { text: "üç≥ Find the kitchen", action: 'kitchen' },
                    { text: "üìö Search the library first", action: 'library' }
                ]
            },

            villa_window: {
                location: "Villa Contarini - Upper Floor",
                text: `Using your climbing gear, you scale the side of the villa and enter through a broken window on the second floor.

<span class="success-text">STEALTH ROUTE - Avoided main dangers</span>

You're in what appears to be a bedroom. Noble furnishings, now rotted. A portrait on the wall shows a family from centuries ago, watching you with painted eyes.

Through a doorway, you can see stairs leading down to the main hall.`,
                choices: [
                    { text: "üîª Go downstairs", action: 'villa_entrance' }
                ]
            },

            library: {
                location: "Villa Contarini - Library",
                text: `The library's shelves still hold hundreds of books, though many are ruined by moisture. You spot research journals from 2037 - the year of The Fracture.

Flipping through them, you find notes about "Project Rinascimento" (Rebirth). Energy experiments. Corporate signatures. Government seals.

<span class="italian-text">"...test soggetti inconsapevoli... acceptable casualties... maggiore profitto..."</span>
(...unknowing test subjects... acceptable casualties... greater profit...)

<span class="danger-text">This was no accident. This was deliberate.</span>

<span class="success-text">+1 CLUE GAINED</span>

Nicole was right. Someone did this on purpose.`,
                onEnter: () => {
                    gameState.clues += 1;
                },
                choices: [
                    { text: "üç≥ Go to the kitchen", action: 'kitchen' }
                ]
            },

            kitchen: {
                location: "Villa Contarini - Kitchen",
                text: `The industrial kitchen is surprisingly intact. Copper pots still hang from racks, though covered in verdigris.

You search behind the stove, the pantry, the walls. Finally, you find it - a section of brick wall that's slightly different. You push, and it swings open revealing a keypad.

1220. Cittadella's founding year. Nicole's note.

You type the numbers. The lock clicks.

<span class="success-text">SECRET DOOR OPENED</span>

Stone stairs descend into darkness. Your geiger counter's clicking intensifies. High radiation below.

You take a deep breath and begin your descent.`,
                choices: [
                    { text: "‚¨áÔ∏è Descend into the cellar", action: 'secret_cellar' }
                ]
            },

            secret_cellar: {
                location: "Secret Research Facility",
                text: `The stairs lead deep underground. This isn't a wine cellar - it's a facility. Concrete walls, steel doors, computer terminals.

Pre-Fracture technology.

And there, slumped against a wall in a hazmat suit...

<span class="success-text">"Nicole!"</span>

She's alive. Barely. Her mask is cracked, contamination exposure evident. But she's breathing.

Her eyes flutter open when she hears your voice.

<span class="italian-text">"Kelly... sapevo che saresti venuta..."</span> (I knew you'd come...)

She weakly points to a computer terminal still flickering with power.

"The... the truth. It's all there. They did this. On purpose. To... to make people dependent on their 'cure'. Millions died so they could... profit..."

She coughs violently.

"I downloaded everything. The evidence. It's on that terminal. But Kelly... we need to decide. Do we expose them? Or... or destroy it? If the survivors know... it might destroy what little hope they have left..."`,
                choices: [
                    { text: "üíæ Download the evidence to expose the truth", action: 'ending_truth' },
                    { text: "üí• Destroy the evidence to preserve hope", action: 'ending_hope' },
                    { text: "üì§ Take Nicole and decide later", action: 'ending_rescue' }
                ]
            },

            ending_truth: {
                location: "Secret Research Facility",
                text: `<div class="victory">ENDING: VERIT√Ä (TRUTH)</div>

You download all the evidence onto a data drive. Names, dates, documents, emails - proof that The Fracture was orchestrated for profit.

With Nicole leaning on your shoulder, you make your way back to Cittadella. The journey is long and difficult, but you both survive.

Three months later, you stand in Piazza Vittorio Emanuele as Padre Angelo reads the evidence to gathered survivors. The truth spreads like wildfire. Anger, grief, determination.

<span class="italian-text">"Non pi√π segreti. Non pi√π bugie. Ricostruiamo insieme."</span>
(No more secrets. No more lies. We rebuild together.)

The factions unite. Armed with the truth, they begin working toward real solutions. It will take generations, but there is purpose now. Direction.

Nicole squeezes your hand. She's weak but recovering.

"We did the right thing," she whispers.

You found Nicole. You found the truth. And maybe, just maybe, you found hope.

<strong>CLUES FOUND: ${gameState.clues}/7</strong>
<strong>FINAL HEALTH: ${gameState.health}</strong>

<em>Grazie per aver giocato. (Thanks for playing.)</em>`,
                onEnter: () => {
                    gameState.gameOver = true;
                },
                choices: [
                    { text: "üîÑ Play Again", action: 'restart' }
                ]
            },

            ending_hope: {
                location: "Secret Research Facility",
                text: `<div class="victory">ENDING: SPERANZA (HOPE)</div>

You look at the terminal for a long moment, then at Nicole. She nods weakly.

"Sometimes... sometimes ignorance is mercy..."

You smash the terminal. Sparks fly. The data is gone forever. The truth dies here in this underground tomb.

Supporting Nicole, you make the long journey back to Cittadella. The guards welcome you as heroes - you found Nicole, alive, in the Red Zone.

Padre Angelo tends to Nicole's injuries. When he asks what you found, you simply say: "Nothing. Just empty ruins."

He looks at you knowingly but doesn't press.

Life in Cittadella continues. The survivors don't know they were victims of corporate greed. They believe it was an accident, a tragedy, but not malice.

Maybe that's better. Maybe some truths are too heavy to bear.

Nicole recovers. On quiet nights, you both wonder if you made the right choice. But you're alive. You're together. And the people of Cittadella have hope.

Sometimes, that's enough.

<strong>CLUES FOUND: ${gameState.clues}/7</strong>
<strong>FINAL HEALTH: ${gameState.health}</strong>

<em>Grazie per aver giocato. (Thanks for playing.)</em>`,
                onEnter: () => {
                    gameState.gameOver = true;
                },
                choices: [
                    { text: "üîÑ Play Again", action: 'restart' }
                ]
            },

            ending_rescue: {
                location: "Secret Research Facility",
                text: `<div class="victory">ENDING: AMORE (LOVE)</div>

"We'll decide later," you say, helping Nicole to her feet. "Right now, I'm getting you home."

You grab the data drive - the evidence - and support Nicole as you climb back up the stairs. The journey through the Red Zone is harrowing. Nicole is weak. Your supplies run low.

But you make it. Together.

At the gates of Cittadella, the guards rush to help. Padre Angelo himself carries Nicole to the cathedral infirmary.

Days pass. Nicole recovers slowly. The data drive sits in your pocket, heavy with responsibility.

One evening, Nicole takes your hand.

<span class="italian-text">"Qual √® la cosa giusta da fare, Kelly?"</span> (What's the right thing to do?)

You still don't know. Maybe you never will. But you have Nicole. You have the truth. And you have time to decide.

Whatever you choose, you'll choose together.

<span class="italian-text">"L'amore supera tutto. Anche la fine del mondo."</span>
(Love overcomes everything. Even the end of the world.)

<strong>CLUES FOUND: ${gameState.clues}/7</strong>
<strong>FINAL HEALTH: ${gameState.health}</strong>

<em>Grazie per aver giocato. (Thanks for playing.)</em>`,
                onEnter: () => {
                    gameState.gameOver = true;
                },
                choices: [
                    { text: "üîÑ Play Again", action: 'restart' }
                ]
            }
        };

        // Game functions
        function updateStats() {
            document.getElementById('health').textContent = gameState.health;
            document.getElementById('supplies').textContent = gameState.supplies;
            document.getElementById('clues').textContent = gameState.clues;
            document.getElementById('inventory-list').textContent = gameState.inventory.join(', ');
        }

        function checkRequirements(requires) {
            if (!requires) return true;
            
            for (let key in requires) {
                if (key === 'inventory') {
                    if (!gameState.inventory.includes(requires[key])) {
                        return false;
                    }
                } else {
                    if (gameState[key] < requires[key]) {
                        return false;
                    }
                }
            }
            return true;
        }

        function loadScene(sceneId) {
            const scene = story[sceneId];
            if (!scene) return;

            // Update location
            gameState.location = sceneId;

            // Run onEnter function if exists
            if (scene.onEnter) {
                scene.onEnter();
            }

            // Update display
            const storyText = document.getElementById('story-text');
            storyText.innerHTML = `
                <div class="location-name">${scene.location}</div>
                <p>${scene.text}</p>
            `;

            // Update choices
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';

            if (gameState.gameOver) {
                updateStats();
                return;
            }

            scene.choices.forEach(choice => {
                const canChoose = checkRequirements(choice.requires);
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.innerHTML = choice.text;
                button.disabled = !canChoose;
                
                if (canChoose) {
                    button.onclick = () => loadScene(choice.action);
                } else {
                    button.title = 'Requirements not met';
                    button.style.opacity = '0.3';
                }
                
                choicesDiv.appendChild(button);
            });

            // Check for game over conditions
            if (gameState.health <= 0) {
                storyText.innerHTML = `
                    <div class="game-over">MORTE</div>
                    <p>Your injuries were too severe. You collapse in the wasteland, Nicole's journal clutched in your hands.</p>
                    <p>Your search ends here.</p>
                    <p><em>Riposa in pace. (Rest in peace.)</em></p>
                `;
                choicesDiv.innerHTML = '<button class="choice-btn" onclick="location.reload()">üîÑ Try Again</button>';
                gameState.gameOver = true;
            }

            updateStats();
            
            // Scroll to top
            document.getElementById('game-screen').scrollTop = 0;
        }

        // Initialize game
        loadScene('start');
    </script>
</body>
</html>
